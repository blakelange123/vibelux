<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vibelux Detailed Spectral Regression Model</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background: #030712;
            color: #e5e7eb;
        }
        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: #111827;
            padding: 40px;
            border-radius: 12px;
            border: 1px solid #1f2937;
        }
        h1 {
            background: linear-gradient(to right, #a855f7, #ec4899);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-align: center;
            font-size: 36px;
            margin-bottom: 10px;
        }
        .subtitle {
            text-align: center;
            color: #9ca3af;
            margin-bottom: 40px;
        }
        .spectrum-section {
            background: #1f2937;
            border-radius: 12px;
            padding: 30px;
            margin: 20px 0;
            border: 1px solid #374151;
        }
        .spectrum-bar {
            display: flex;
            height: 80px;
            border-radius: 8px;
            overflow: hidden;
            margin: 20px 0;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
        }
        .spectrum-segment {
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 14px;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
            flex-direction: column;
            gap: 5px;
        }
        .uv { background: linear-gradient(135deg, #7c3aed, #9333ea); }
        .violet { background: linear-gradient(135deg, #8b5cf6, #a855f7); }
        .blue { background: linear-gradient(135deg, #3b82f6, #2563eb); }
        .cyan { background: linear-gradient(135deg, #06b6d4, #0891b2); }
        .green { background: linear-gradient(135deg, #10b981, #059669); }
        .yellow { background: linear-gradient(135deg, #f59e0b, #d97706); }
        .red { background: linear-gradient(135deg, #ef4444, #dc2626); }
        .far-red { background: linear-gradient(135deg, #991b1b, #7f1d1d); }
        
        .formula {
            background: #030712;
            border: 1px solid #374151;
            border-radius: 8px;
            padding: 20px;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
            color: #10b981;
            overflow-x: auto;
            font-size: 13px;
            line-height: 1.8;
        }
        
        .spectrum-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: #111827;
            border-radius: 8px;
            overflow: hidden;
        }
        .spectrum-table th {
            background: #374151;
            color: #f3f4f6;
            padding: 12px;
            text-align: left;
            font-weight: 600;
        }
        .spectrum-table td {
            padding: 12px;
            border-bottom: 1px solid #374151;
            color: #e5e7eb;
        }
        .spectrum-table tr:hover {
            background: #1f2937;
        }
        
        .recipe-card {
            background: #111827;
            border: 1px solid #374151;
            border-radius: 8px;
            padding: 20px;
            margin: 15px 0;
        }
        .recipe-card h4 {
            color: #a855f7;
            margin-bottom: 15px;
        }
        
        .optimization-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .correlation-matrix {
            overflow-x: auto;
            margin: 20px 0;
        }
        .correlation-matrix table {
            width: 100%;
            border-collapse: collapse;
            font-size: 12px;
        }
        .correlation-matrix th,
        .correlation-matrix td {
            border: 1px solid #374151;
            padding: 8px;
            text-align: center;
        }
        .correlation-matrix th {
            background: #374151;
            color: #f3f4f6;
        }
        .positive-strong {
            background: rgba(16, 185, 129, 0.3);
            color: #10b981;
            font-weight: bold;
        }
        .positive-moderate {
            background: rgba(16, 185, 129, 0.15);
            color: #10b981;
        }
        .negative-strong {
            background: rgba(239, 68, 68, 0.3);
            color: #ef4444;
            font-weight: bold;
        }
        .negative-moderate {
            background: rgba(239, 68, 68, 0.15);
            color: #ef4444;
        }
        
        h2 {
            color: #a855f7;
            margin-top: 30px;
            margin-bottom: 20px;
        }
        h3 {
            color: #ec4899;
            margin-top: 20px;
            margin-bottom: 15px;
        }
        
        .insight-box {
            background: linear-gradient(135deg, rgba(124, 58, 237, 0.1) 0%, rgba(236, 72, 153, 0.1) 100%);
            border: 1px solid #7c3aed;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Detailed Spectral Composition Regression Model</h1>
        <p class="subtitle">Complete breakdown of light spectrum percentages and their correlations with crop outcomes</p>

        <div class="spectrum-section">
            <h2>Full Spectrum Breakdown (380-780nm)</h2>
            
            <div class="spectrum-bar">
                <div class="spectrum-segment uv" style="flex: 0.5;">
                    <span>UV</span>
                    <span style="font-size: 10px;">380-400nm</span>
                </div>
                <div class="spectrum-segment violet" style="flex: 0.7;">
                    <span>Violet</span>
                    <span style="font-size: 10px;">400-420nm</span>
                </div>
                <div class="spectrum-segment blue" style="flex: 1.5;">
                    <span>Blue</span>
                    <span style="font-size: 10px;">420-490nm</span>
                </div>
                <div class="spectrum-segment cyan" style="flex: 0.8;">
                    <span>Cyan</span>
                    <span style="font-size: 10px;">490-520nm</span>
                </div>
                <div class="spectrum-segment green" style="flex: 1.2;">
                    <span>Green</span>
                    <span style="font-size: 10px;">520-565nm</span>
                </div>
                <div class="spectrum-segment yellow" style="flex: 0.5;">
                    <span>Yellow</span>
                    <span style="font-size: 10px;">565-590nm</span>
                </div>
                <div class="spectrum-segment red" style="flex: 2;">
                    <span>Red</span>
                    <span style="font-size: 10px;">590-700nm</span>
                </div>
                <div class="spectrum-segment far-red" style="flex: 1;">
                    <span>Far-Red</span>
                    <span style="font-size: 10px;">700-780nm</span>
                </div>
            </div>

            <table class="spectrum-table">
                <thead>
                    <tr>
                        <th>Wavelength Band</th>
                        <th>Range (nm)</th>
                        <th>Typical %</th>
                        <th>Primary Effects</th>
                        <th>Key Metrics Affected</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>UV-A</strong></td>
                        <td>380-400</td>
                        <td>0-3%</td>
                        <td>Stress response, flavonoid production</td>
                        <td>THC (+0.5-2%), Anthocyanins (+30%)</td>
                    </tr>
                    <tr>
                        <td><strong>Violet</strong></td>
                        <td>400-420</td>
                        <td>2-5%</td>
                        <td>Cryptochrome activation, anthocyanin</td>
                        <td>Color intensity (+25%), Antioxidants (+20%)</td>
                    </tr>
                    <tr>
                        <td><strong>Blue</strong></td>
                        <td>420-490</td>
                        <td>10-25%</td>
                        <td>Stomatal opening, compact growth</td>
                        <td>Internode length (-40%), WUE (+15%)</td>
                    </tr>
                    <tr>
                        <td><strong>Cyan</strong></td>
                        <td>490-520</td>
                        <td>3-8%</td>
                        <td>Phototropism, chlorophyll synthesis</td>
                        <td>Leaf angle, Chlorophyll b</td>
                    </tr>
                    <tr>
                        <td><strong>Green</strong></td>
                        <td>520-565</td>
                        <td>5-15%</td>
                        <td>Canopy penetration, shade avoidance</td>
                        <td>Lower leaf photosynthesis (+20%)</td>
                    </tr>
                    <tr>
                        <td><strong>Yellow</strong></td>
                        <td>565-590</td>
                        <td>2-5%</td>
                        <td>Carotenoid absorption</td>
                        <td>Î²-carotene, Lutein content</td>
                    </tr>
                    <tr>
                        <td><strong>Red</strong></td>
                        <td>590-700</td>
                        <td>35-60%</td>
                        <td>Primary photosynthesis driver</td>
                        <td>Biomass (+35%), Yield (+25%)</td>
                    </tr>
                    <tr>
                        <td><strong>Far-Red</strong></td>
                        <td>700-780</td>
                        <td>5-20%</td>
                        <td>Shade response, flowering, stem elongation</td>
                        <td>Height (+30%), Flowering (-5 days)</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="spectrum-section">
            <h2>Complete Spectral Regression Model</h2>
            
            <div class="formula">
# Detailed Spectral Composition Variables (% of total PPFD)
UV_A_percent = PPFD_380_400 / PPFD_total Ã 100
Violet_percent = PPFD_400_420 / PPFD_total Ã 100
Blue_percent = PPFD_420_490 / PPFD_total Ã 100
Cyan_percent = PPFD_490_520 / PPFD_total Ã 100
Green_percent = PPFD_520_565 / PPFD_total Ã 100
Yellow_percent = PPFD_565_590 / PPFD_total Ã 100
Red_percent = PPFD_590_700 / PPFD_total Ã 100
Far_red_percent = PPFD_700_780 / PPFD_total Ã 100

# Enhanced Regression Model with Spectral Percentages
Yield = Î²â + 
    Î²â(DLI_total) + 
    Î²â(UV_A_%) + Î²â(UV_A_%Â²) +                    # Non-linear UV response
    Î²â(Violet_%) + 
    Î²â(Blue_%) + Î²â(Blue_%Â²) +                    # Optimal blue range
    Î²â(Cyan_%) + 
    Î²â(Green_%) +                                  # Often underestimated
    Î²â(Yellow_%) + 
    Î²ââ(Red_%) + Î²ââ(Red_%Â²) +                    # Diminishing returns
    Î²ââ(Far_red_%) + Î²ââ(Far_red_%Â²) +           # Shade avoidance
    Î²ââ(Blue_% Ã Red_%) +                         # Key interaction
    Î²ââ(Red_% / Far_red_%) +                      # R:FR ratio
    Î²ââ(UV_A_% Ã Temperature) +                   # Stress interaction
    Î²ââ(Green_% Ã Canopy_depth) +                 # Penetration effect
    Î²ââ(Stage Ã Spectrum_vector) +                # Stage-specific
    Îµ

# Example: Cannabis THC Production Model
THC_percent = Î±â + 
    Î±â(UV_A_%) Ã 2.31 +                           # Strong positive
    Î±â(UV_A_%Â²) Ã -0.28 +                         # Diminishing at high levels
    Î±â(Blue_%) Ã 0.82 +
    Î±â(Violet_%) Ã 1.15 +                         # Often overlooked
    Î±â(Temperature Ã UV_A_%) Ã 0.43 +             # Interaction effect
    Î±â(Stress_days Ã UV_exposure) Ã 0.67 +
    Î±â(Genetics_factor) Ã 3.21 +
    Î±â(DLI_flowering) Ã 0.54 +
    Îµ

# Lettuce Quality Model
Lettuce_quality = Î³â + 
    Î³â(Blue_%) Ã 1.43 +                           # Compact growth
    Î³â(Red_%) Ã 0.92 +                            # Biomass
    Î³â(Far_red_%) Ã -0.67 +                       # Negative for compactness
    Î³â(Green_%) Ã 0.38 +                          # Nutritional value
    Î³â(Blue_% - 20)Â² Ã -0.15 +                    # Optimal around 20%
    Î³â(R:FR_ratio) Ã 0.84 +                       # Morphology control
    Îµ</div>
        </div>

        <div class="spectrum-section">
            <h2>Optimal Spectral Recipes by Crop & Stage</h2>
            
            <div class="optimization-grid">
                <div class="recipe-card">
                    <h4>ð¥¬ Lettuce - Vegetative</h4>
                    <div class="spectrum-bar" style="height: 40px;">
                        <div class="spectrum-segment uv" style="flex: 0;">0%</div>
                        <div class="spectrum-segment violet" style="flex: 3;">3%</div>
                        <div class="spectrum-segment blue" style="flex: 22;">22%</div>
                        <div class="spectrum-segment cyan" style="flex: 5;">5%</div>
                        <div class="spectrum-segment green" style="flex: 8;">8%</div>
                        <div class="spectrum-segment yellow" style="flex: 2;">2%</div>
                        <div class="spectrum-segment red" style="flex: 55;">55%</div>
                        <div class="spectrum-segment far-red" style="flex: 5;">5%</div>
                    </div>
                    <ul style="font-size: 14px; margin-top: 10px;">
                        <li>High blue (22%) for compact growth</li>
                        <li>R:FR ratio = 11:1 prevents stretching</li>
                        <li>Predicted yield: +18% vs standard</li>
                    </ul>
                </div>

                <div class="recipe-card">
                    <h4>ð Tomatoes - Flowering</h4>
                    <div class="spectrum-bar" style="height: 40px;">
                        <div class="spectrum-segment uv" style="flex: 0;">0%</div>
                        <div class="spectrum-segment violet" style="flex: 2;">2%</div>
                        <div class="spectrum-segment blue" style="flex: 12;">12%</div>
                        <div class="spectrum-segment cyan" style="flex: 4;">4%</div>
                        <div class="spectrum-segment green" style="flex: 10;">10%</div>
                        <div class="spectrum-segment yellow" style="flex: 3;">3%</div>
                        <div class="spectrum-segment red" style="flex: 57;">57%</div>
                        <div class="spectrum-segment far-red" style="flex: 12;">12%</div>
                    </div>
                    <ul style="font-size: 14px; margin-top: 10px;">
                        <li>Increased far-red (12%) for fruit set</li>
                        <li>Green (10%) for canopy penetration</li>
                        <li>Brix increase: +1.2 units</li>
                    </ul>
                </div>

                <div class="recipe-card">
                    <h4>ð¿ Cannabis - Late Flower</h4>
                    <div class="spectrum-bar" style="height: 40px;">
                        <div class="spectrum-segment uv" style="flex: 2.5;">2.5%</div>
                        <div class="spectrum-segment violet" style="flex: 4;">4%</div>
                        <div class="spectrum-segment blue" style="flex: 15;">15%</div>
                        <div class="spectrum-segment cyan" style="flex: 3;">3%</div>
                        <div class="spectrum-segment green" style="flex: 5.5;">5.5%</div>
                        <div class="spectrum-segment yellow" style="flex: 2;">2%</div>
                        <div class="spectrum-segment red" style="flex: 58;">58%</div>
                        <div class="spectrum-segment far-red" style="flex: 10;">10%</div>
                    </div>
                    <ul style="font-size: 14px; margin-top: 10px;">
                        <li>UV-A (2.5%) for THC/terpene boost</li>
                        <li>Violet (4%) enhances trichomes</li>
                        <li>THC increase: +2.1% absolute</li>
                    </ul>
                </div>

                <div class="recipe-card">
                    <h4>ð¿ Basil - Essential Oil</h4>
                    <div class="spectrum-bar" style="height: 40px;">
                        <div class="spectrum-segment uv" style="flex: 1;">1%</div>
                        <div class="spectrum-segment violet" style="flex: 5;">5%</div>
                        <div class="spectrum-segment blue" style="flex: 25;">25%</div>
                        <div class="spectrum-segment cyan" style="flex: 6;">6%</div>
                        <div class="spectrum-segment green" style="flex: 7;">7%</div>
                        <div class="spectrum-segment yellow" style="flex: 2;">2%</div>
                        <div class="spectrum-segment red" style="flex: 48;">48%</div>
                        <div class="spectrum-segment far-red" style="flex: 6;">6%</div>
                    </div>
                    <ul style="font-size: 14px; margin-top: 10px;">
                        <li>High blue (25%) for oil production</li>
                        <li>UV + Violet (6%) for aroma</li>
                        <li>Essential oil: +35% vs control</li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="spectrum-section">
            <h2>Spectral Correlation Matrix</h2>
            
            <div class="correlation-matrix">
                <table>
                    <thead>
                        <tr>
                            <th>Spectrum %</th>
                            <th>Yield</th>
                            <th>Height</th>
                            <th>Internode</th>
                            <th>THC/Oil</th>
                            <th>Chlorophyll</th>
                            <th>WUE</th>
                            <th>Flowering</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>UV-A (0-3%)</strong></td>
                            <td class="negative-moderate">-0.15</td>
                            <td class="negative-moderate">-0.12</td>
                            <td class="negative-moderate">-0.18</td>
                            <td class="positive-strong">+0.68</td>
                            <td>+0.05</td>
                            <td class="negative-moderate">-0.22</td>
                            <td>-0.08</td>
                        </tr>
                        <tr>
                            <td><strong>Blue (10-25%)</strong></td>
                            <td class="positive-moderate">+0.42</td>
                            <td class="negative-strong">-0.58</td>
                            <td class="negative-strong">-0.72</td>
                            <td class="positive-moderate">+0.35</td>
                            <td class="positive-strong">+0.61</td>
                            <td class="positive-strong">+0.53</td>
                            <td class="negative-moderate">-0.15</td>
                        </tr>
                        <tr>
                            <td><strong>Green (5-15%)</strong></td>
                            <td class="positive-moderate">+0.28</td>
                            <td class="positive-moderate">+0.22</td>
                            <td class="positive-moderate">+0.18</td>
                            <td>+0.08</td>
                            <td class="positive-moderate">+0.15</td>
                            <td>+0.12</td>
                            <td>+0.05</td>
                        </tr>
                        <tr>
                            <td><strong>Red (35-60%)</strong></td>
                            <td class="positive-strong">+0.78</td>
                            <td class="positive-moderate">+0.35</td>
                            <td class="positive-moderate">+0.28</td>
                            <td class="positive-moderate">+0.42</td>
                            <td class="positive-strong">+0.55</td>
                            <td class="positive-moderate">+0.38</td>
                            <td class="positive-moderate">+0.45</td>
                        </tr>
                        <tr>
                            <td><strong>Far-Red (5-20%)</strong></td>
                            <td class="positive-moderate">+0.32</td>
                            <td class="positive-strong">+0.68</td>
                            <td class="positive-strong">+0.75</td>
                            <td class="negative-moderate">-0.25</td>
                            <td class="negative-moderate">-0.18</td>
                            <td class="negative-moderate">-0.28</td>
                            <td class="positive-strong">+0.62</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div class="insight-box">
            <h3>Key Insights from Spectral Percentage Analysis</h3>
            <ol>
                <li><strong>Non-linear responses:</strong> Most wavelengths have optimal ranges with diminishing or negative returns outside those ranges</li>
                <li><strong>Interaction effects:</strong> Blue Ã Red interaction explains 15% of yield variance alone</li>
                <li><strong>Stage-specific:</strong> Optimal percentages shift dramatically between vegetative and flowering</li>
                <li><strong>Green light matters:</strong> 5-15% green improves canopy photosynthesis by 20% vs 0% green</li>
                <li><strong>UV threshold:</strong> Benefits plateau at 3%, damage begins at 5%</li>
                <li><strong>R:FR ratio:</strong> More predictive than individual R or FR percentages</li>
            </ol>
        </div>

        <div class="spectrum-section">
            <h2>Dynamic Spectrum Optimization Algorithm</h2>
            
            <div class="formula">
# Real-time Spectrum Adjustment Based on Feedback
def optimize_spectrum_percentages(current_state, target_outcomes):
    # Current spectrum composition
    spectrum = {
        'UV_A': current_state['UV_A_percent'],      # 0-3%
        'Violet': current_state['Violet_percent'],   # 2-5%
        'Blue': current_state['Blue_percent'],       # 10-25%
        'Cyan': current_state['Cyan_percent'],       # 3-8%
        'Green': current_state['Green_percent'],     # 5-15%
        'Yellow': current_state['Yellow_percent'],   # 2-5%
        'Red': current_state['Red_percent'],         # 35-60%
        'Far_Red': current_state['Far_Red_percent']  # 5-20%
    }
    
    # Multi-objective optimization
    objectives = {
        'yield': weight_yield,
        'quality': weight_quality,
        'energy_efficiency': weight_energy,
        'morphology': weight_morphology
    }
    
    # Constraints
    constraints = [
        sum(spectrum.values()) == 100,  # Must total 100%
        spectrum['UV_A'] <= 3,           # UV limit for safety
        spectrum['Blue'] >= 10,          # Minimum for health
        spectrum['Red'] >= 35,           # Minimum for growth
        DLI_total <= DLI_max,            # Total light limit
        Heat_load <= Heat_max            # Thermal constraint
    ]
    
    # Gradient descent with constraints
    for iteration in range(max_iterations):
        gradient = calculate_gradient(spectrum, objectives, sensor_feedback)
        spectrum = update_spectrum(spectrum, gradient, learning_rate)
        spectrum = apply_constraints(spectrum, constraints)
        
        if convergence_reached(gradient):
            break
    
    return spectrum

# Example output for late-stage cannabis:
optimized_spectrum = {
    'UV_A': 2.3,      # Maximized for THC within safety limits  
    'Violet': 4.1,    # Supporting trichome development
    'Blue': 14.8,     # Reduced from vegetative (was 22%)
    'Cyan': 3.2,      # Minimal but present
    'Green': 5.8,     # Penetration for lower buds
    'Yellow': 2.1,    # Minimal
    'Red': 57.2,      # Primary driver
    'Far_Red': 10.5   # Flower development signal
}
# Total: 100.0%</div>
        </div>
    </div>
</body>
</html>